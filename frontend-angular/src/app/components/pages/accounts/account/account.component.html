<h1 class="p-4 mx-md-5 pb-0">{{'Accounts'|translate}}</h1>
<div class="mx-md-5">
  <div class="mt-3 w-100">
    <mat-form-field class="w-100">
      <mat-label>{{'Search'|translate}}</mat-label>
      <input matInput (keyup)="applyFilter($event)" placeholder="..." #input>
    </mat-form-field>
  </div>
  <div class="mat-elevation-z4 table-responsive mb-3">
    <table mat-table [dataSource]="dataSource" matSort multiTemplateDataRows cdkDropList
      cdkDropListOrientation="horizontal" (cdkDropListDropped)="drop($event)">

      <ng-container matColumnDef="name">
        <th mat-header-cell cdkDrag *matHeaderCellDef mat-sort-header> {{'Name'|translate}} </th>
        <td mat-cell *matCellDef="let element"> {{element.person?.name}} </td>
      </ng-container>

      <ng-container matColumnDef="age">
        <th mat-header-cell cdkDrag *matHeaderCellDef mat-sort-header> {{'Age'|translate}} </th>
        <td mat-cell *matCellDef="let element"> {{element.person?.birthDate|fromNow:true}} </td>
      </ng-container>

      <ng-container matColumnDef="username">
        <th mat-header-cell cdkDrag *matHeaderCellDef mat-sort-header> {{'Username'|translate}} </th>
        <td mat-cell *matCellDef="let element"> {{element.username}} </td>
      </ng-container>

      <ng-container matColumnDef="roles">
        <th mat-header-cell cdkDrag *matHeaderCellDef mat-sort-header> {{'Roles'|translate}} </th>
        <td mat-cell *matCellDef="let element"> {{this.ut.displayRoles(element.roles)}} </td>
      </ng-container>

      <ng-container matColumnDef="createdDatetime">
        <th mat-header-cell cdkDrag *matHeaderCellDef mat-sort-header> {{'Created Date'|translate}} </th>
        <td mat-cell *matCellDef="let el"> {{ el.createdDatetime|fromNow }} </td>
      </ng-container>

      <ng-container matColumnDef="expand">
        <th mat-header-cell *matHeaderCellDef aria-label="row actions">&nbsp;</th>
        <td mat-cell *matCellDef="let item">
          <button mat-icon-button aria-label="expand row"
            (click)="(expandedItem = expandedItem === item ? null : item); $event.stopPropagation()">
            <mat-icon>{{expandedItem === item ? 'keyboard_arrow_up' : 'keyboard_arrow_down'}}</mat-icon>
          </button>
        </td>
      </ng-container>

      <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
      <ng-container matColumnDef="expandedDetail">
        <td mat-cell *matCellDef="let item" [attr.colspan]="columnsKeys.length">
          <div class="w-100"
            [@detailExpand]="item == expandedItem ? 'expanded' : 'collapsed'">
            <div class="row d-flex justify-content-center align-items-center mb-3 mb-md-0">
              <div class="col-md-9">
                <p>
                  <b>{{'Gender'|translate}}:&nbsp;</b><span *ngIf="item.gender">{{item.gender|translate}}</span><span *ngIf="!item.gender">‹{{'Empty'|translate}}›</span><br/>
                  <span *ngIf="item.roles.includes('Parent')"><b>{{'Address'|translate}}:&nbsp;</b><span *ngIf="item.address">{{item.address}}</span><span *ngIf="!item.address">‹{{'Empty'|translate}}›</span><br>
                  <b>{{'Phones'|translate}}:&nbsp;</b><span
                    *ngIf="item.phone0||item.phone1||item.phone2||item.phone3||item.phone4||item.phone5||item.phone6||item.phone7||item.phone8||item.phone9">{{displayPhones([item.phone0,item.phone1,item.phone2,item.phone3,item.phone4,item.phone5,item.phone6,item.phone7,item.phone8,item.phone9])}}.</span><span
                    *ngIf="!item.phone0&&!item.phone1&&!item.phone2&&!item.phone3&&!item.phone4&&!item.phone5&&!item.phone6&&!item.phone7&&!item.phone8&&!item.phone9"
                    class="opacity-50 fst-italic fw-bold">‹{{'Empty'|translate}}›</span></span>
                </p>
              </div>
              <div class="col-md-3">
                <!-- <a [routerLink]="'/accounts/'+item.id" class="mx-3" mat-flat-button
                  color="primary">{{'Goals'|translate}}</a> -->
                  <!--reset password & addEditDelete role are in edit-account page -->
                <button class="m-1" mat-stroked-button color="primary" (click)="edit(this.expandedItem)"><mat-icon>edit</mat-icon>{{'Edit'|translate}}</button>
                <button class="m-1" mat-stroked-button color="primary" (click)="deleteAccount(this.expandedItem)"><mat-icon>delete</mat-icon>{{'Delete'|translate}}</button>
              </div>
            </div>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="columnsKeys"></tr>
      <tr mat-row *matRowDef="let item; columns:columnsKeys;" class="table-row"
        [class.example-expanded-row]="expandedItem === item"
        (click)="expandedItem = expandedItem === item?undefined:item"></tr>
      <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row"></tr>
    </table>
    <mat-paginator [pageSizeOptions]="[5, 10, 20,50,100]" showFirstLastButtons>
    </mat-paginator>
  </div>

  <a mat-raised-button color="primary" routerLink="/add-account">{{'Register new account'|translate}}<mat-icon>add</mat-icon></a>
</div>
