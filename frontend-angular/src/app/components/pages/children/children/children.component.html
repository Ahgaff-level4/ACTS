<h1 class="p-4 mx-md-5 pb-0">{{'Children'|translate}}</h1>
<div class="mx-md-5  mb-5 pb-5">
  <div class="mt-3 w-100">
    <mat-form-field class="w-100">
      <mat-label>{{'Search'|translate}}</mat-label>
      <input matInput (keyup)="applyFilter($event)" placeholder="..." #input>
    </mat-form-field>
  </div>
  <div class="mat-elevation-z4 table-responsive mb-3">
    <table mat-table [dataSource]="dataSource" matSort multiTemplateDataRows cdkDropList
      cdkDropListOrientation="horizontal" (cdkDropListDropped)="drop($event)">

      <ng-container matColumnDef="name">
        <th mat-header-cell cdkDrag *matHeaderCellDef mat-sort-header> {{'Name'|translate}} </th>
        <td mat-cell *matCellDef="let element"> {{element.person?.name}} </td>
      </ng-container>

      <ng-container matColumnDef="age">
        <th mat-header-cell cdkDrag *matHeaderCellDef mat-sort-header> {{'Age'|translate}} </th>
        <td mat-cell *matCellDef="let element"> {{element.person?.birthDate|fromNow:true}} </td>
      </ng-container>

      <ng-container matColumnDef="diagnostic">
        <th mat-header-cell cdkDrag *matHeaderCellDef mat-sort-header> {{'Diagnostic'|translate}} </th>
        <td mat-cell *matCellDef="let element"> {{element.diagnostic}} </td>
      </ng-container>

      <ng-container matColumnDef="gender">
        <th mat-header-cell cdkDrag *matHeaderCellDef mat-sort-header> {{'Gender'|translate}} </th>
        <td mat-cell *matCellDef="let element"> {{element.person?.gender|translate}} </td>
      </ng-container>

      <ng-container matColumnDef="createdDatetime">
        <th mat-header-cell cdkDrag *matHeaderCellDef mat-sort-header> {{'Created Date'|translate}} </th>
        <td mat-cell *matCellDef="let el"> {{ el.createdDatetime|fromNow }} </td>
      </ng-container>

      <ng-container matColumnDef="expand">
        <th mat-header-cell *matHeaderCellDef aria-label="row actions">&nbsp;</th>
        <td mat-cell *matCellDef="let item">
          <button mat-icon-button aria-label="expand row"
            (click)="(expandedItem = expandedItem === item ? null : item); $event.stopPropagation()">
            <mat-icon>{{expandedItem === item ? 'keyboard_arrow_up' : 'keyboard_arrow_down'}}</mat-icon>
          </button>
        </td>
      </ng-container>

      <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
      <ng-container matColumnDef="expandedDetail">
        <td mat-cell *matCellDef="let item" [attr.colspan]="columnsKeys.length">
          <div class="w-100"
            [@detailExpand]="item == expandedItem ? 'expanded' : 'collapsed'">
            <div class="row d-flex justify-content-center align-items-center mb-3 mb-md-0">
              <div class="col-md-9">
                <app-add-edit-child></app-add-edit-child>
                <!-- <p>
                  <b>{{'Birthdate'|translate}}:&nbsp;</b><span
                    *ngIf="item.person.birthDate">{{item.person.birthDate|toDate}}.</span><span
                    *ngIf="!item.person.birthDate"
                    class="opacity-50 fst-italic fw-bold">‹{{'Empty'|translate}}›</span><br />
                  <b>{{'Order between siblings'|translate}}:&nbsp;</b><span
                    *ngIf="item.birthOrder || item.maleFamilyMembers || item.femaleFamilyMembers ">{{ut.ordinalNumbers[item.birthOrder-1]|translate}}&nbsp;{{'of'|translate}}
                    {{item.maleFamilyMembers+item.femaleFamilyMembers+1}}&nbsp;{{'siblings'|translate}}&nbsp;({{item.femaleFamilyMembers+(item.gender==='Female'?1:0)}}&nbsp;{{'girls'|translate}}{{','|translate}}&nbsp;{{item.maleFamilyMembers+(item.gender==='Male'?1:0)}}&nbsp;{{'boys'|translate}}).</span><span
                    *ngIf="!item.birthOrder && !item.femaleFamilyMembers && !item.maleFamilyMembers"
                    class="opacity-50 fst-italic fw-bold">‹{{'Empty'|translate}}›</span><br />
                  <b>{{'Parent kinship'|translate}}:&nbsp;</b><span
                    *ngIf="item.parentsKinship">{{item.parentsKinship}}.</span><span *ngIf="!item.parentsKinship"
                    class="opacity-50 fst-italic fw-bold">‹{{'Empty'|translate}}›</span><br />
                  <b>{{'Duration spent'|translate}}:&nbsp;</b><span
                    *ngIf="item.person.createdDatetime">{{item.person.createdDatetime|fromNow}}&nbsp;{{'from register
                    date'|translate}}&nbsp;{{item.person.createdDatetime|toDate}}.</span><span
                    *ngIf="!item.person.createdDatetime"
                    class="opacity-50 fst-italic fw-bold">‹{{'Empty'|translate}}›</span><br />
                  <b>{{'Diagnostic date'|translate}}:&nbsp;</b><span
                    *ngIf="item.diagnosticDate">{{item.diagnosticDate|toDate}}.</span><span *ngIf="!item.diagnosticDate"
                    class="opacity-50 fst-italic fw-bold">‹{{'Empty'|translate}}›</span><br />
                  <b>{{'Pregnancy state'|translate}}:&nbsp;</b><span
                    *ngIf="item.pregnancyState">{{item.pregnancyState}}.</span><span *ngIf="!item.pregnancyState"
                    class="opacity-50 fst-italic fw-bold">‹{{'Empty'|translate}}›</span><br />
                  <b>{{'Birth state'|translate}}:&nbsp;</b><span
                    *ngIf="item.birthState">{{item.birthState}}.</span><span *ngIf="!item.birthState"
                    class="opacity-50 fst-italic fw-bold">‹{{'Empty'|translate}}›</span><br />
                  <b>{{'Growth state'|translate}}:&nbsp;</b><span
                    *ngIf="item.growthState">{{item.growthState}}.</span><span *ngIf="!item.growthState"
                    class="opacity-50 fst-italic fw-bold">‹{{'Empty'|translate}}›</span><br />
                  <b>{{'Diagnostic'|translate}}:&nbsp;</b><span *ngIf="item.diagnostic">{{item.diagnostic}}.</span><span
                    *ngIf="!item.diagnostic" class="opacity-50 fst-italic fw-bold">‹{{'Empty'|translate}}›</span><br />
                  <b>{{'Medicines'|translate}}:&nbsp;</b><span *ngIf="item.medicine">{{item.medicine}}.</span><span
                    *ngIf="!item.medicine" class="opacity-50 fst-italic fw-bold">‹{{'Empty'|translate}}›</span><br />
                  <b>{{'Behaviors'|translate}}:&nbsp;</b><span *ngIf="item.behaviors">{{item.behaviors}}.</span><span
                    *ngIf="!item.behaviors" class="opacity-50 fst-italic fw-bold">‹{{'Empty'|translate}}›</span><br />
                  <b>{{'Priority skills'|translate}}:&nbsp;</b><span
                    *ngIf="item.prioritySkills">{{item.prioritySkills}}.</span><span *ngIf="!item.prioritySkills"
                    class="opacity-50 fst-italic fw-bold">‹{{'Empty'|translate}}›</span>
                </p> -->
              </div>
              <div class="col-md-3">
                  <a [routerLink]="'/goals/'+item.id" class="m-1" mat-stroked-button color="primary">{{'Goals'|translate}}</a>
                  <button *ngIf="canAddEdit" class="m-1" mat-stroked-button color="primary"
                    (click)="edit(this.expandedItem)"><mat-icon>edit</mat-icon>{{'Edit'|translate}}</button>
              </div>
            </div>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="columnsKeys"></tr>
      <tr mat-row *matRowDef="let item; columns:columnsKeys;" class="table-row"
        [class.example-expanded-row]="expandedItem === item"
        (click)="expandedItem = expandedItem === item?undefined:item"></tr>
      <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row"></tr>
    </table>
    <mat-paginator [pageSizeOptions]="[5, 10, 20,50,100]" showFirstLastButtons>
    </mat-paginator>
  </div>

  <a *ngIf="canAddEdit" mat-raised-button color="primary" routerLink="/add-child">{{'Register a child'|translate}}<mat-icon>person_add</mat-icon></a>
</div>
